<Window x:Class="SportClub.View.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        xmlns:local="clr-namespace:SportClub.ViewModel"
        xmlns:misc="clr-namespace:SportClub.Miscellaneous"
        mc:Ignorable="d"
        Title="MainWindow" Height="700" Width="1200">
    <Window.Resources>
        <misc:ResetFilterClientParametersConverter x:Key="ResetFilterClientConverter" />

        <Style TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False" />
            <Setter Property="CanUserAddRows" Value="False" />
            <Setter Property="CanUserDeleteRows" Value="False" />
        </Style>
        <Style TargetType="{x:Type Control}" x:Key="color1">
            <Setter Property="Background"  Value="SeaShell" />
        </Style>
        <Style TargetType="{x:Type Control}" x:Key="color2">
            <Setter Property="Background"  Value="AntiqueWhite" />
        </Style>
        <Style TargetType="{x:Type Control}" x:Key="buttonCRUD">
            <Setter Property="Background"  Value="Snow" />
            <Setter Property="FontSize" Value="14" />
        </Style>
        <Style TargetType="{x:Type Control}" x:Key="fontSizeBig">
            <Setter Property="FontSize" Value="16" />
        </Style>
        <Style TargetType="{x:Type Control}" x:Key="fontSizeNormal">
            <Setter Property="FontSize" Value="10" />
        </Style>

        <Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource fontSizeBig}"></Style>
        <Style TargetType="{x:Type Menu}" BasedOn="{StaticResource color2}"></Style>
        <Style TargetType="{x:Type TabControl}" BasedOn="{StaticResource color1}"></Style>
        <Style TargetType="{x:Type Button}" BasedOn="{StaticResource buttonCRUD}"></Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="1*"/>
            <RowDefinition Height="17*"/>
        </Grid.RowDefinitions>

        <Menu x:Name="TopMenu" Grid.Row="0" VerticalAlignment="Top" Height="32">
            <MenuItem Header="Файл">
                <MenuItem Header="Сохранить" />
                <MenuItem Header="Закрыть" />
            </MenuItem>
            <MenuItem Header="Статистика" />
            <MenuItem Header="SQL запрос" Click="SQLquery_Click" />
            <MenuItem Header="Анализ эффективности" />
        </Menu>

        <TabControl Grid.Row="1" Margin="0,1.4,-0.4,-33.6" >
            <!-- < Clients TAB > -->
            <TabItem x:Name="ClientsTab" Header="Клиенты БИО" d:DataContext="{d:DesignInstance d:Type=local:ClientsTabViewModel, IsDesignTimeCreatable=True}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>

                    <DataGrid Grid.Column="0" x:Name="ClientsGrid" ItemsSource="{Binding Context.Clients.Local}" SelectedItem="{Binding SelectedClient, Mode=TwoWay}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="№" Binding="{Binding ClientId}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Фамилия" Binding="{Binding FirstName}"/>
                            <DataGridTextColumn Header="Имя" Binding="{Binding LastName}"/>
                            <DataGridTextColumn Header="Дата рождения" Binding="{Binding Path=BirthDate, StringFormat={}{0:dd, MMMM, yyyy}}"/>
                            <DataGridTextColumn Header="Пол" Binding="{Binding Gender}"/>
                            <DataGridTextColumn Header="Телефон" Binding="{Binding PhoneNumber}"/>
                            <DataGridTextColumn Header="Email" Binding="{Binding Email}"/>
                            <DataGridTextColumn Header="Регистрация" Binding="{Binding Path=RegistrationDate, StringFormat={}{0:dd, MMMM, yyyy}}"/>
                        </DataGrid.Columns>
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="SelectionChanged">
                                <i:InvokeCommandAction Command="{Binding ClientsGridSelectionChangedCommand}"/>
                                <i:InvokeCommandAction Command="{Binding TrainingSelectChangedCommand}"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </DataGrid>

                    <Border Grid.Column="1" BorderThickness="1" Margin="50" CornerRadius="10" BorderBrush="LightBlue">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>

                            <!-- < Clients CRUD > -->
                            <Expander Grid.Row="0"  Header="Редактирование" IsExpanded="True">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[1].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[2].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[3].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="3" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[4].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="4" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[5].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="5" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[6].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="6" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[7].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="7" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[8].Header, StringFormat={}{0}:}"/>

                                    <TextBox Grid.Row="0" Grid.Column="1" Margin="3" Text="{Binding ClientInfo.FirstName, Mode=TwoWay}"/>
                                    <TextBox Grid.Row="1" Grid.Column="1" Margin="3" Text="{Binding ClientInfo.LastName, Mode=TwoWay}"/>
                                    <DatePicker Grid.Row="2" Grid.Column="1" Margin="3" SelectedDate="{Binding ClientInfo.BirthDate, Mode=TwoWay}"/>
                                    <ComboBox x:Name="GenderType" Grid.Row="3" Grid.Column="1" Margin="3" 
                                              SelectedValue="{Binding ClientInfo.Gender, Mode=TwoWay}" ItemsSource="{Binding GenderTypes, Mode=OneTime}" />

                                    <TextBox Grid.Row="4" Grid.Column="1" Margin="3" Text="{Binding ClientInfo.PhoneNumber, Mode=TwoWay}"/>
                                    <TextBox Grid.Row="5" Grid.Column="1" Margin="3" Text="{Binding ClientInfo.Email, Mode=TwoWay}"/>
                                    <DatePicker Grid.Row="6" Grid.Column="1" Margin="3" SelectedDate="{Binding ClientInfo.RegistrationDate, Mode=TwoWay}"/>

                                    <DockPanel Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="2" HorizontalAlignment="Center" Width="{Binding RelativeSource={RelativeSource AncestorType=Grid, Mode=FindAncestor}, Path=ActualWidth}">
                                        <Button Margin="7" Padding="10,2,10,2" Content="Добавить" Command="{Binding AddClientCommand}"/>
                                        <Button Margin="7" Padding="10,2,10,2" Content="Изменить" Command="{Binding UpdateClientCommand}"/>
                                        <Button Margin="7" Padding="10,2,10,2" Content="Удалить" Command="{Binding DeleteClientCommand}"/>
                                        <Button Margin="5" Padding="10,2,10,2" HorizontalAlignment="Right" Content="Договор" Command="{Binding SaveDocumentClient}"/>
                                    </DockPanel>
                                </Grid>
                            </Expander>
                            
                            <!-- < Clients Filter > -->
                            <Expander Grid.Row="1"  Header="Фильтры">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[0].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[1].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[2].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="3" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[3].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="4" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[4].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="5" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[5].Header, StringFormat={}{0}:}"/>
                                    <TextBlock Grid.Row="6" Grid.Column="0" Margin="5" Text="{Binding ElementName=ClientsGrid, Path=Columns[6].Header, StringFormat={}{0}:}"/>

                                    <TextBox x:Name="IdTbFilter" Grid.Row="0" Grid.Column="1" Margin="3" Text="{Binding ClientFilter.FirstName, UpdateSourceTrigger=PropertyChanged}">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="TextChanged">
                                                <i:InvokeCommandAction Command="{Binding ClientsFilterChangedCommand}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                    <TextBox x:Name="FnTbFilter" Grid.Row="1" Grid.Column="1" Margin="3" Text="{Binding ClientFilter.FirstName, UpdateSourceTrigger=PropertyChanged}">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="TextChanged">
                                                <i:InvokeCommandAction Command="{Binding ClientsFilterChangedCommand}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                    <TextBox x:Name="LnTbFilter" Grid.Row="2" Grid.Column="1" Margin="3" Text="{Binding ClientFilter.LastName, UpdateSourceTrigger=PropertyChanged}">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="TextChanged">
                                                <i:InvokeCommandAction Command="{Binding ClientsFilterChangedCommand}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                    <DatePicker x:Name="BdDpFilter" Grid.Row="3" Grid.Column="1" Margin="3" SelectedDate="{Binding ClientFilter.BirthDate}">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="SelectedDateChanged">
                                                <i:InvokeCommandAction Command="{Binding ClientsFilterChangedCommand}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </DatePicker>
                                    <ComboBox x:Name="GDpFilter" Grid.Row="4" Grid.Column="1" Margin="3" 
                                              SelectedValue="{Binding ClientFilter.Gender, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                ItemsSource="{Binding GenderTypes, Mode=OneTime}">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="SelectionChanged">
                                                <i:InvokeCommandAction Command="{Binding ClientsFilterChangedCommand}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </ComboBox>
                                    <TextBox x:Name="PnTbFilter" Grid.Row="5" Grid.Column="1" Margin="3" Text="{Binding ClientFilter.PhoneNumber, UpdateSourceTrigger=PropertyChanged}">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="TextChanged">
                                                <i:InvokeCommandAction Command="{Binding ClientsFilterChangedCommand}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>
                                    <TextBox x:Name="ETbFilter" Grid.Row="6" Grid.Column="1" Margin="3" Text="{Binding ClientFilter.Email, UpdateSourceTrigger=PropertyChanged}">
                                        <i:Interaction.Triggers>
                                            <i:EventTrigger EventName="TextChanged">
                                                <i:InvokeCommandAction Command="{Binding ClientsFilterChangedCommand}"/>
                                            </i:EventTrigger>
                                        </i:Interaction.Triggers>
                                    </TextBox>

                                    <Button Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="2" Margin="4,5,4,5" Content="Сбросить фильтры" Command="{Binding ResetFilterClientCommand}">
                                        <Button.CommandParameter>
                                            <MultiBinding Converter="{StaticResource ResetFilterClientConverter}">
                                                <Binding ElementName="IdTbFilter"/>
                                                <Binding ElementName="FnTbFilter"/>
                                                <Binding ElementName="LnTbFilter"/>
                                                <Binding ElementName="BdDpFilter"/>
                                                <Binding ElementName="GDpFilter"/>
                                                <Binding ElementName="PnTbFilter"/>
                                                <Binding ElementName="ETbFilter"/>
                                            </MultiBinding>
                                        </Button.CommandParameter>
                                    </Button>
                                    <DataGrid Grid.Row="8" Grid.Column="0"  Grid.ColumnSpan="2" ItemsSource="{Binding FilteredClientList}">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="№" Binding="{Binding ClientId}"/>
                                            <DataGridTextColumn Header="Фамилия" Binding="{Binding FirstName}"/>
                                            <DataGridTextColumn Header="Имя" Binding="{Binding LastName}"/>
                                            <DataGridTextColumn Header="Дата рождения" Binding="{Binding Path=BirthDate, StringFormat={}{0:dd, MMMM, yyyy}}"/>
                                            <DataGridTextColumn Header="Пол" Binding="{Binding Gender}"/>
                                            <DataGridTextColumn Header="Телефон" Binding="{Binding PhoneNumber}"/>
                                            <DataGridTextColumn Header="Email" Binding="{Binding Email}"/>
                                            <DataGridTextColumn Header="Регистрация" Binding="{Binding Path=RegistrationDate, StringFormat={}{0:dd, MMMM, yyyy}}"/>
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <DataGrid Grid.Row="9" Grid.Column="0" Grid.ColumnSpan="2" ItemsSource="{Binding TrainingsList}" Margin="10,10.4,10.4,10.2">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="№" Binding="{Binding TrainingId}"/>
                                            <DataGridTextColumn Header="Клиент" Binding="{Binding ClientId}"/>
                                            <DataGridTextColumn Header="Дата" Binding="{Binding TrainingDate}"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Expander>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
            <!-- </ Clients TAB > -->
        </TabControl>
    </Grid>
</Window>
